# 完成工作 - 提交前检查清单

在提交或提交代码前，使用此检查清单确保工作完整性。

**时机**：代码编写和测试完成后，提交前

---

## 检查清单

### 1. 代码质量

```bash
# 必须通过
pnpm lint
pnpm type-check
pnpm test
```

- [ ] `pnpm lint` 通过，0 个错误？
- [ ] `pnpm type-check` 通过，无类型错误？
- [ ] 测试通过？
- [ ] 没有 `console.log` 语句（使用 logger）？
- [ ] 没有非空断言（`x!` 操作符）？
- [ ] 没有 `any` 类型？

### 2. 文档同步

**规范文档**：
- [ ] `.trellis/spec/backend/` 需要更新吗？
  - 新模式、新模块、新规范
- [ ] `.trellis/spec/frontend/` 需要更新吗？
  - 新组件、新 hooks、新模式
- [ ] `.trellis/spec/guides/` 需要更新吗？
  - 新的跨层流程、从 bug 中学到的教训

**关键问题**：
> "如果我修复了一个 bug 或发现了一些不明显的东西，我是否应该记录下来，以便将来的我（或其他人）不会遇到同样的问题？"

如果是 -> 更新相关规范文档。

### 3. API 变更

如果修改了 API 端点：

- [ ] 输入 schema 已更新？
- [ ] 输出 schema 已更新？
- [ ] API 文档已更新？
- [ ] 客户端代码已更新以匹配？

### 4. 数据库变更

如果修改了数据库 schema：

- [ ] 迁移文件已创建？
- [ ] Schema 文件已更新？
- [ ] 相关查询已更新？
- [ ] 种子数据已更新（如适用）？

### 5. 跨层验证

如果变更跨越多个层：

- [ ] 数据正确流经所有层？
- [ ] 每个边界的错误处理正常工作？
- [ ] 类型在各层之间一致？
- [ ] 加载状态已处理？

### 6. 手动测试

- [ ] 功能在浏览器/应用中正常工作？
- [ ] 边缘情况已测试？
- [ ] 错误状态已测试？
- [ ] 页面刷新后仍正常工作？

---

## 快速检查流程

```bash
# 1. 代码检查
pnpm lint && pnpm type-check

# 2. 查看变更
git status
git diff --name-only

# 3. 根据变更的文件，检查上述相关项目
```

---

## 常见遗漏

| 遗漏 | 后果 | 检查方法 |
|-----------|-------------|-------|
| 规范文档未更新 | 其他人不知道变更 | 检查 .trellis/spec/ |
| 迁移未创建 | Schema 不同步 | 检查 db/migrations/ |
| 类型未同步 | 运行时错误 | 检查共享类型 |
| 测试未更新 | 虚假的信心 | 运行完整测试套件 |
| 遗留 Console.log | 生产日志噪音 | 搜索 console.log |

---

## 与其他命令的关系

```
开发流程:
  编写代码 -> 测试 -> /trellis-finish-work -> git commit -> /trellis-record-session
                          |                              |
                     确保完整性                        记录进度
                   
调试流程:
  遇到 bug -> 修复 -> /trellis-break-loop -> 知识沉淀
                       |
                  深度分析
```

- `/trellis-finish-work` - 检查工作完整性（本命令）
- `/trellis-record-session` - 记录会话和提交
- `/trellis-break-loop` - 调试后的深度分析

---

## 核心原则

> **交付不仅包括代码，还包括文档、验证和知识沉淀。**

完整的工作 = 代码 + 文档 + 测试 + 验证
